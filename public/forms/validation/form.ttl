@prefix form: <http://lblod.data.gift/vocabularies/forms/> .
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix mu: <http://mu.semte.ch/vocabularies/core/> .
@prefix displayTypes: <http://lblod.data.gift/display-types/> .
@prefix ext: <http://mu.semte.ch/vocabularies/ext/> .
@prefix schema: <http://schema.org/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix nie: <http://www.semanticdesktop.org/ontologies/2007/01/19/nie#> .
@prefix fieldGroups: <http://data.lblod.info/field-groups/> .
@prefix fields: <http://data.lblod.info/fields/> .
@prefix concept: <http://lblod.data.gift/concept-schemes/> .

##########################################################
# Form
##########################################################
ext:form a form:Form, form:TopLevelForm ;
  form:includes ext:formNodesL .

##########################################################
#  Parent groups aka Property Groups
##########################################################
ext:formFieldPg a form:PropertyGroup;
  sh:name "Field" ;
  sh:order 1 .

ext:formFieldValidations a form:PropertyGroup;
  sh:name "Validation" ;
  sh:order 2 .


##########################################################
#  Scopes:
##########################################################
ext:formNodesS a form:Scope;
  sh:path form:includes.

ext:formValidationsS a form:Scope;
  sh:path form:validations.

##########################################################
#  Field with add validation button:
##########################################################
ext:formNodesFormItem a form:SubForm;
  form:includes ext:formNodesNameF;
  form:hasFieldGroup ext:formFieldPg .

ext:formNodesNameF a form:Field ;
  sh:name "Field name" ;
  sh:order 1 ;
  sh:path sh:name ;
  form:displayType displayTypes:defaultInput;
  sh:group ext:formFieldPg .

ext:formNodesL a form:Listing;
  form:each ext:formValidationItem;
  form:scope ext:formNodesS;
  sh:group ext:formFieldPg;
  sh:order 3 .

##########################################################
#  Validation Subform:
##########################################################
ext:formValidationItem a form:SubForm;
  form:includes ext:formNodesNameF;
  form:includes ext:formValidationL;
  form:hasFieldGroup ext:formFieldPg .

##########################################################
#  Validation Listing:
##########################################################
ext:formValidationL a form:Listing;
  form:each ext:formValidationValueItem;
  form:scope ext:formValidationsS;
  form:canAdd true;
  form:addLabel "Validation";
  form:canRemove true;
  form:removeLabel "Remove section";
  form:createGenerator ext:addValidationGenerator;
  sh:group ext:formFieldPg;
  sh:order 3 .

ext:formValidationValueItem a form:SubForm;
  form:includes fields:validatonSelectorF;
  form:hasFieldGroup fieldGroups:RequiredValidationFieldGroup.

##########################################################
#  Section for adding validations to the field:
##########################################################
fields:validatonSelectorF a form:Field ;
  sh:name "Validation type" ;
  sh:order  2 ;
  sh:path rdf:type ;
  form:help """
    e.g. Required, Max Length,..
   """;
  form:validations [
    a form:RequiredConstraint ;
      form:grouping form:Bag ;
      sh:resultMessage "Dit veld is verplicht."@nl
    ] ;
  form:displayType displayTypes:conceptSchemeSelector ;
  form:options """{"conceptScheme":"http://lblod.data.gift/concept-schemes/dde3d2a3-e848-47ea-ba44-0f2e565f04ab","searchEnabled":true}""" ;
  sh:group ext:formFieldValidations .

##########################################################
#  Generators:
##########################################################
ext:addValidationGenerator a form:Generator;
  form:prototype [
    form:shape [
        a ext:blankNode ;
        form:grouping form:Bag ;
    ]
  ].

##########################################################
#  Conditional Fields:
##########################################################
ext:validationResultMessageF a form:Field ;
  sh:name "Error message" ;
  sh:order 3 ;
  sh:path sh:resultMessage ;
  form:displayType displayTypes:defaultInput;
  sh:group ext:formFieldValidations .

##########################################################
#  Field Groups:
##########################################################
fieldGroups:RequiredValidationFieldGroup a form:FieldGroup ;
  form:hasField ext:validationResultMessageF.

##########################################################
#  Conditions:
##########################################################
fields:requiredValidationConditionF a form:ConditionalFieldGroup ;
  form:conditions
    [ a form:SingleCodelistValue ;
      form:grouping form:Bag ;
      sh:path rdf:type;
      form:conceptScheme concept:dde3d2a3-e848-47ea-ba44-0f2e565f04ab ;
      form:customValue form:RequiredConstraint
    ] ;
  form:hasFieldGroup fieldGroups:RequiredValidationFieldGroup.


##########################################################
#  Assignment of fieldgroup to field:
##########################################################
fields:validatonSelectorF form:hasConditionalFieldGroup fields:requiredValidationConditionF.