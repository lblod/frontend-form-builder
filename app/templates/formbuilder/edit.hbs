{{page-title 'Formbuilder'}}

<Toolbar
  @model={{this.model}}
  @code={{this.code}}
  @setActiveTab={{this.setActiveTab}}
  @formChanged={{this.formChanged}}
  @refresh={{this.refresh}}
  @setFormChanged={{this.setFormChanged}}
/>

<main id="main" class="au-c-main-container">
  <div class="au-c-main-container__content">
     <div class="playground__tab">
        Builder
        <AuToggleSwitch
          @checked={{this.isAddingValidationToForm}}
          @onChange={{this.toggleIsAddingValidationToForm}}
        >Validation</AuToggleSwitch>
      </div>
    <div class="playground">
      <div class="playground__edit">
        <AuBodyContainer @scroll={{true}} class="au-o-box">
          {{#if this.isAddingValidationToForm}}
            <h1>Validation tab</h1>
            <ul>
              {{#each this.fieldsInForm as |field|}}
                <li>{{field.fieldName}}</li>
                <ul>
                  {{#each field.validationTypes as |type|}}
                    <li>{{type.value}}</li>
                  {{/each}}
                </ul>
                {{log 'selected validation' this.selectedValidation}}
                <PowerSelectMultiple
                  @allowClear={{true}}
                  @renderInPlace={{true}}
                  @disabled={{false}}
                  @searchEnabled={{true}}
                  @loadingMessage={{'Opties zijn aan het laden..'}}
                  @noMatchesMessage={{'Geen gevonden resultaten'}}
                  @searchMessage={{'Type om te zoeken'}}
                  @options={{this.validationOptions}}
                  @selected={{this.selectedValidations}}
                  @placeholder={{'Selecteer een waarde'}}
                  @onChange={{fn (mut this.selectedValidations)}}
                  as |multipleselect|
                >
                  {{multipleselect}}
                </PowerSelectMultiple>
                <AuButton
                  {{on 'click' (fn this.addIsRequiredValidationToField field)}}
                >Add selected validation to field</AuButton>
              {{/each}}
            </ul>
          {{else}}
            {{#if (and this.isInitialDataLoaded this.builderStore)}}
              <RdfForm
                @groupClass="au-o-grid__item"
                @form={{this.builderForm}}
                @graphs={{this.graphs}}
                @formStore={{this.builderStore}}
                @forceShowErrors={{true}}
                @useNewListingLayout={{true}}
                @sourceNode={{this.previewForm}}
              />
            {{else}}
              <AuLoader />
            {{/if}}
          {{/if}}
        </AuBodyContainer>
      </div>
      <div class="playground__show">
        <div class="au-u-margin-top-small">
          {{#if this.refresh.isRunning}}
            <AuLoader />
          {{else}}
            <RdfForm
              @groupClass="au-u-margin-left-small au-u-margin-top"
              @form={{this.previewForm}}
              @graphs={{this.graphs}}
              @sourceNode={{this.sourceNode}}
              @formStore={{this.previewStore}}
              @forceShowErrors={{true}}
              @useNewListingLayout={{true}}
            />
          {{/if}}
        </div>
      </div>
    </div>
  </div>
</main>